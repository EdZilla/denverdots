{"ts":1348934765763,"silentsave":true,"restoring":false,"patch":[[{"diffs":[[1,"var fs = require(\"fs\");\nvar http = require(\"http\");\n\nvar ipaddr = process.env.OPENSHIFT_INTERNAL_IP || \"0.0.0.0\";\nvar port = process.env.OPENSHIFT_INTERNAL_PORT || process.env.C9_PORT || 8080;\n\nvar server = http.createServer(function(req, res) {\n    if (req.url.match(/^\\/(index.html)?$/)) {\n        return serve(res, \"/www/index.html\");\n    }\n    else if (req.url.match(/^\\/styles.css$/)) {\n        return serve(res, \"/www/styles.css\", \"text/css\");\n    }\n    else if (req.url.match(/^\\/zenbg.png$/)) {\n        return serve(res, \"/www/zenbg.png\", \"text/css\");\n    }\n    else if (req.url.match(/^\\/client.js$/)) {\n        return serve(res, \"/www/client.js\", \"text/javascript\");\n    }\n    res.writeHead(404, {\n        \"Content-Type\": \"text/html\"\n    });\n    res.end(\"404 Not Funded\");\n});\n\nserver.listen(port, ipaddr);\nvar io = require(\"socket.io\").listen(server);\nio.configure(function() {\n    io.set('transports', ['xhr-polling']);\n    io.set('polling duration', 10);\n});\nio.set(\"log level\", 2);\n\nio.sockets.on(\"connection\", function(socket) {\n    var id = socket.id;\n\n    socket.on(\"cursor\", function(data) {\n        data.id = id;\n        io.sockets.emit(\"cursor\", data);\n    });\n\n    socket.on(\"chat\", function(data) {\n        io.sockets.emit(\"chat\", {\n            id: id,\n            value: data\n        });\n    });\n\n    socket.on(\"click\", function() {\n        io.sockets.emit(\"click\", id);\n    });\n\n    socket.on(\"disconnect\", function() {\n        io.sockets.emit(\"remove\", id);\n    });\n});\n\n\n// UTILS\n\nfunction serve(res, path, mime) {\n    fs.readFile(__dirname + path, function(err, data) {\n        if (err) return error(res, err);\n\n        res.writeHead(200, {\n            \"Content-Type\": mime || \"text/html\"\n        });\n        res.end(data);\n    });\n}\n\nfunction error(res, err) {\n    res.writeHead(500, {\n        \"Content-Type\": \"text/plain\"\n    });\n    res.end(\"Internal server error: \" + err);\n    console.log(err);\n}"]],"start1":0,"start2":0,"length1":0,"length2":1928}]],"length":1928}
